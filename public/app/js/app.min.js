var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,e={next:function(){if(b<a.length){var d=b++;return{value:c(d,a[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,c,b,e){if(c){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in b||(b[d]={});b=b[d]}a=a[a.length-1];e=b[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var e=a.length,d=0;d<e;d++){var f=a[d];if(c.call(b,f,d,a))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");var app=angular.module("app",["ui.router","nvd3","angularMoment","chieffancypants.loadingBar"]).config(["$stateProvider","$urlRouterProvider",function(a,c){a.state("app",{url:"",component:"dashboard"})}]);
app.service("API",["$http",function(a){this.balance=function(c){return a.get("/api/ledger/balance",{params:{period:c.period,categories:c.categories,depth:c.depth}})};this.register=function(c){return a.get("/api/ledger/register",{params:{period:c.period,categories:c.categories}})};this.graph_values=function(c){return a.get("/api/ledger/graph_values",{params:{period:c.period,categories:c.categories}})};this.budget=function(c){return a.get("/api/ledger/budget",{params:{period:c.period,categories:c.categories}})};
this.dates_salaries=function(){return a.get("/ai/ledger/dates_salaries")};this.accounts=function(){return a.get("/api/ledger/accounts")};this.cleared=function(){return a.get("/api/ledger/cleared")}}]);
app.component("bucket",{bindings:{categories:"\x3c",period:"\x3c"},controller:["$filter","API",function(a,c){var b=this;b.depth=99;b.graph_options={chart:{type:"multiBarHorizontalChart",height:600,margin:{top:20,right:20,bottom:20,left:200},x:function(a){return a.account},y:function(a){return a.amount},valueFormat:function(a){return a+" \u20ac"},showYAxis:!1,showValues:!0,showLegend:!0,showControls:!1,showTooltipPercent:!0,duration:500,labelThreshold:.01,labelSunbeamLayout:!0,labelsOutside:!0}};b.$onChanges=
function(a){a.period&&void 0!=a.period.currentValue&&c.balance({period:b.period,categories:b.categories,depth:b.depth}).then(function(a){b.raw_data=_(a.data).sortBy(function(a){return a.amount}).reverse();b.raw_total=_(a.data).reduce(function(a,b){return a+b.amount},0);b.total_detailed=_.chain(b.raw_data).groupBy(function(a){return a.account.split(":")[0]}).each(function(a){a.total=_(a).reduce(function(a,b){return a+b.amount},0)}).value();b.total_detailed=_.chain(b.total_detailed).keys().map(function(a){return{account:a,
amount:b.total_detailed[a].total}}).value();b.graph_options.chart.height=60+25*b.raw_data.length;b.data=b.categories.split(" ").map(function(a){return{key:a,values:_(b.raw_data).select(function(b){return b.account.match("^"+a+":.*")})}})})}}],template:'\n  \x3cdiv class\x3d"bucket"\x3e\n    \x3cdiv class\x3d"tollbar"\x3e\n      \x3cspan ng:repeat\x3d"account in $ctrl.total_detailed"\x3e{{account.account}} \x3d {{account.amount | number:2}} \u20ac\x3c/span\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"content"\x3e\n      \x3cdiv class\x3d"graph"\x3e\n        \x3cnvd3 data\x3d"$ctrl.data"\n              options\x3d"$ctrl.graph_options"\x3e\n        \x3c/nvd3\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n'});
app.component("dashboard",{controller:["$filter","API",function(a,c){var b=this;b.graphed_accounts=["Expenses","Income"];c.accounts().then(function(a){b.raw_accounts=a.data;b.accounts=b.raw_accounts.map(function(a){return a.join(":")})});(function(a){c.graph_values(a).then(function(a){b.periods=[];var c=_(a.data).reduce(function(a,b){return b.length>a.length?b:a},[]);_.chain(c).pluck("date").each(function(b){_(a.data).each(function(a){var c=_(a).find({date:b});_(c).isUndefined()&&a.push({date:b,amount:0,
currency:_(a).first().currency})})});_(a.data).each(function(a){a=_(a).sortBy(function(a){return a.date})});b.graphiques={monthly_values:{options:{chart:{type:"multiBarChart",height:300,showControls:!1,showLegend:!0,showLabels:!0,showValues:!0,showYAxis:!1,x:function(a){return a.x},y:function(a){return a.y},valueFormat:function(a){return a+" \u20ac"},xAxis:{tickFormat:function(a){return""+a+(a==b.period?"*":"")}},stacked:!1,duration:500,reduceXTicks:!1,rotateLabels:-67,labelSunbeamLayout:!0,useInteractiveGuideline:!0,
multibar:{dispatch:{elementClick:function(a){console.log("change period");console.log(b.period);b.period=a.data.x;console.log(b.period)}}}}},data:_.chain(a.data).keys().reverse().map(function(c){var e="Income"==c?-1:1;return{key:c,values:_.chain(a.data[c]).map(function(a){var d=new Date(a.date);d=d.getFullYear()+"-"+(9>d.getMonth()?"0":"")+(d.getMonth()+1);b.periods.push(d);return{key:c,x:d,y:parseInt(a.amount)*e}}).sortBy(function(a){return a.x}).value()}}).value()}};b.periods=_.chain(b.periods).uniq().sort().reverse().value();
b.period=_(b.periods).first()})})({period:"",categories:b.graphed_accounts.join(" ")})}],template:'\n  \x3cdiv class\x3d"dashboard"\x3e\n    \x3cdiv class\x3d"global-graph" style\x3d"height: 300px;"\x3e\n      \x3cdiv class\x3d"accounts" style\x3d"width: 20%; height: 100%; float: left;"\x3e\n        \x3cselect style\x3d"height: 100%;" multiple ng:model\x3d"$ctrl.graphed_accounts"\x3e\n          \x3coption ng:repeat\x3d"account in $ctrl.accounts"\x3e{{account}}\x3c/option\x3e\n        \x3c/select\x3e\n      \x3c/div\x3e\n      \x3cdiv class\x3d"graph" style\x3d"width: 80%; float: left;"\x3e\n        \x3cnvd3 data\x3d"$ctrl.graphiques.monthly_values.data"\n              options\x3d"$ctrl.graphiques.monthly_values.options"\x3e\n        \x3c/nvd3\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n\n    \x3ch1 style\x3d"text-align: center;"\x3e\n      \x3cselect ng:options\x3d"p as p | amDateFormat:\'MMMM YYYY\' for p  in $ctrl.periods" ng:model\x3d"$ctrl.period"\x3e\x3c/select\x3e\n      {{$ctrl.period}}\n    \x3c/h1\x3e\n\n    \x3cbucket categories\x3d"\'Expenses Income Equity Liabilities\'" period\x3d"$ctrl.period"\x3e\x3c/bucket\x3e\n  \x3c/div\x3e\n'});
