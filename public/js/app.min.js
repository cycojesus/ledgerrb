var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,e={next:function(){if(b<a.length){var d=b++;return{value:c(d,a[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,c,b,e){if(c){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in b||(b[d]={});b=b[d]}a=a[a.length-1];e=b[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,b){return b})}},"es6","es3");
$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var e=a.length,d=0;d<e;d++){var f=a[d];if(c.call(b,f,d,a))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var app=angular.module("app",["ui.router","nvd3","angularMoment","chieffancypants.loadingBar","rzModule"]).config(["$stateProvider","$urlRouterProvider",function(a,c){a.state("app",{url:"",component:"dashboard"})}]);
app.service("API",["$http",function(a){this.balance=function(c,b,e){return a.get("/api/ledger/balance",{params:{period:c,categories:b,depth:e}})};this.register=function(c,b){return a.get("/api/ledger/register",{params:{period:c,categories:b}})};this.graph_values=function(c,b,e){return a.get("/api/ledger/graph_values",{params:{period:c,granularity:b,categories:e}})};this.accounts=_.memoize(function(){return a.get("/api/ledger/accounts")})}]);
app.component("bucket",{bindings:{categories:"\x3c",period:"\x3c"},controller:["$filter","API",function(a,c){var b=this;b.depth=99;b.graph_options={chart:{type:"multiBarHorizontalChart",height:600,margin:{top:20,right:20,bottom:20,left:200},x:function(a){return a.account},y:function(a){return a.amount},valueFormat:function(a){return a+" \u20ac"},showYAxis:!1,showValues:!0,showLegend:!0,showControls:!1,showTooltipPercent:!0,duration:500,labelThreshold:.01,labelSunbeamLayout:!0,labelsOutside:!0,multibar:{dispatch:{elementClick:function(a){c.register(b.period,
a.data.account).then(function(b){swal({title:b.data.key,html:'\n  \x3ctable style\x3d"width: 100%;"\x3e\n    \x3cthead\x3e\n      \x3ctr\x3e\n        \x3ctd\x3eDate\x3c/td\x3e\x3ctd\x3ePayee\x3c/td\x3e\x3ctd\x3eAmount\x3c/td\x3e\n      \x3c/tr\x3e\n    \x3c/thead\x3e\n    \x3ctbody\x3e\n      '+b.data.values.map(function(a){return"\n  \x3ctr\x3e\n    \x3ctd\x3e"+a.date+"\x3c/td\x3e\n    \x3ctd\x3e"+a.payee+'\x3c/td\x3e\n    \x3ctd style\x3d"text-align: right;"\x3e'+a.amount+" "+a.currency+"\x3c/td\x3e\n  \x3c/tr\x3e"}).join("")+
'\n    \x3c/tbody\x3e\n    \x3ctfoot\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3eTotal\x3c/td\x3e\x3ctd style\x3d"text-align: right;"\x3e'+a.data.amount+" \u20ac\x3c/td\x3e\x3c/tfoot\x3e\n  \x3c/table\x3e"})},function(a){alert("error!")})}}}}};b.$onChanges=function(a){a.period&&void 0!=a.period.currentValue&&c.balance(b.period,b.categories,b.depth).then(function(a){b.raw_data=_(a.data).sortBy(function(a){return a.name});b.graph_options.chart.height=60+25*b.raw_data.length;b.data=b.categories.split(" ").map(function(a){return{key:a,
values:_(b.raw_data).select(function(b){return b.account.match("^"+a+":.*")})}})})}}],template:'\n  \x3cdiv class\x3d"bucket"\x3e\n    \x3cdiv class\x3d"content"\x3e\n      \x3cdiv class\x3d"graph"\x3e\n        \x3cnvd3 data\x3d"$ctrl.data"\n              options\x3d"$ctrl.graph_options"\x3e\n        \x3c/nvd3\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n'});
app.component("dashboard",{controller:["$filter","API",function(a,c){var b=this;b.granularity="monthly";b.account_selection="depth";b.compute_selected_accounts=function(){b.graphed_accounts=_.chain(b.main_accounts_depths).map(function(a){return 1>a.depth?null:_(b.raw_accounts).select(function(b){return b[0]==a.name&&b.length==a.depth}).map(function(a){return a.join(":")})}).compact().flatten().value();b.retrieve_graph_values(b.graphed_accounts)};b.retrieve_graph_values=function(a){c.graph_values("",
b.granularity,a.join(" ")).then(function(a){b.periods=[];_.chain(a.data).reduce(function(a,b){return b.length>a.length?b:a},[]).pluck("date").each(function(b){_(a.data).each(function(a){var c=_(a).find({date:b});_(c).isUndefined()&&a.push({date:b,amount:0,currency:_(a).first().currency})})}).each(function(a){a=_(a).sortBy(function(a){return a.date})});b.graphique={options:{chart:{type:"multiBarChart",height:450,stacked:!0,showControls:!0,showLegend:!0,showLabels:!0,showValues:!0,showYAxis:!0,duration:500,
reduceXTicks:!1,rotateLabels:-67,labelSunbeamLayout:!0,useInteractiveGuideline:!0,interactiveLayer:{dispatch:{elementClick:function(a){console.log(b.period);b.period=a.pointXValue;console.log(b.period)}},tooltip:{contentGenerator:function(a){var b=a.series.reduce(function(a,b){return a+b.value},0);return"\n\x3ch2\x3e"+a.value+"\x3c/h2\x3e\n\x3ctable\x3e\n  \x3ctbody\x3e\n    "+function(a){a.sort(function(a,b){return b.value-a.value});return a.filter(function(a){return 0!=a.value})}(a.series).map(function(a){return'\n\x3ctr\x3e\n\x3ctd style\x3d"background-color: '+
a.color+'"\x3e \x3c/td\x3e\n\x3ctd\x3e'+a.key+'\x3c/td\x3e\n\x3ctd style\x3d"text-align: right; font-weight: bold;"\x3e'+a.value+"\x3c/td\x3e\n\x3c/tr\x3e\n"}).join("")+'\n  \x3c/tbody\x3e\n  \x3ctfoot\x3e\n    \x3ctr style\x3d"color: #ececec; background-color: '+(0>b?"green":"red")+'"\x3e\n      \x3ctd\x3e \x3c/td\x3e\n      \x3ctd style\x3d"text-align: right; text-decoration: underline; font-weight: bold;"\x3eTotal\x3c/td\x3e\n      \x3ctd style\x3d"text-align: right; font-weight: bold;"\x3e'+b+
"\x3c/td\x3e\n    \x3c/tr\x3e\n  \x3c/tfoot\x3e\n\x3c/table\x3e\n"}}}}},data:_.chain(a.data).keys().reverse().map(function(c){return{key:c,values:_.chain(a.data[c]).map(function(a){var d=new Date(a.date);d="monthly"==b.granularity?d.getFullYear()+"-"+(9>d.getMonth()?"0":"")+(d.getMonth()+1):d.getFullYear();b.periods.push(d);return{key:c,x:d,y:parseInt(a.amount)}}).sortBy(function(a){return a.x}).value()}}).value()};b.periods=_.chain(b.periods).uniq().sort().reverse().value();b.period=_(b.periods).first()})};
c.accounts().then(function(a){b.raw_accounts=a.data.sort(function(a){return a.length}).reverse();b.accounts=b.raw_accounts.map(function(a){return a.join(":")});b.main_accounts_depths=_.chain(b.raw_accounts).select(function(a){return 1==a.length}).map(function(a){return{name:a[0],depth:_(["Expenses"]).contains(a[0])?2:_(["Income"]).contains(a[0])?1:0,max_depth:_.chain(b.raw_accounts).select(function(b){return b[0]==a[0]}).reduce(function(a,b){return b.length>a?b.length:a},0).value()}}).value();b.compute_selected_accounts()})}],
template:'\n  \x3cdiv class\x3d"dashboard"\x3e\n    \x3cdiv class\x3d"global-graph" style\x3d"height: 450px;"\x3e\n      \x3cdiv class\x3d"accounts" style\x3d"width: 20%; height: 100%; float: left;"\x3e\n        \x3cdiv style\x3d"width: 100%; float: left;"\x3e\n          \x3clabel\x3e\x3cinput type\x3d"radio" ng:model\x3d"$ctrl.account_selection" value\x3d"depth" name\x3d"depth"/\x3edepth\x3c/label\x3e\n          \x3clabel\x3e\x3cinput type\x3d"radio" ng:model\x3d"$ctrl.account_selection" value\x3d"list" name\x3d"list"/\x3elist\x3c/label\x3e\n        \x3c/div\x3e\n        \x3cdiv style\x3d"width: 100%; height: 90%; float: left;"\x3e\n          \x3cul ng:if\x3d"$ctrl.account_selection \x3d\x3d \'depth\'"\x3e\n            \x3cli ng:repeat\x3d"account in $ctrl.main_accounts_depths"\x3e\n              \x3clabel\x3e{{account.name}} depth\x3c/label\x3e\n              \x3crzslider rz-slider-options\x3d"{floor: 0, ceil: account.max_depth, onEnd: $ctrl.compute_selected_accounts}" rz-slider:model\x3d"account.depth"\x3e\x3c/rzslider\x3e\n            \x3c/li\x3e\n          \x3c/ul\x3e\n\n          \x3cselect style\x3d"height: 100%; width: 100%;" multiple\n                  ng:model\x3d"$ctrl.graphed_accounts"\n                  ng:change\x3d"$ctrl.retrieve_graph_values($ctrl.graphed_accounts)"\n                  ng:if\x3d"$ctrl.account_selection \x3d\x3d \'list\'"\x3e\n            \x3coption ng:repeat\x3d"account in $ctrl.accounts"\x3e{{account}}\x3c/option\x3e\n          \x3c/select\x3e\n        \x3c/div\x3e\n\n        \x3cdiv style\x3d"width: 100%; float: left;"\x3e\n          \x3clabel\x3e\x3cinput type\x3d"radio" ng:model\x3d"$ctrl.granularity" value\x3d"monthly" name\x3d"monthly" ng:change\x3d"$ctrl.compute_selected_accounts()" /\x3emonthly\x3c/label\x3e\n          \x3clabel\x3e\x3cinput type\x3d"radio" ng:model\x3d"$ctrl.granularity" value\x3d"yearly" name\x3d"yearly" ng:change\x3d"$ctrl.compute_selected_accounts()" /\x3eyearly\x3c/label\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n\n      \x3cdiv class\x3d"graph" style\x3d"width: 80%; float: left;"\x3e\n        \x3cnvd3 data\x3d"$ctrl.graphique.data"\n              options\x3d"$ctrl.graphique.options"\x3e\n        \x3c/nvd3\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n\n    \x3ch1 style\x3d"text-align: center;"\x3e\n      \x3cselect ng:options\x3d"p as p for p in $ctrl.periods" ng:model\x3d"$ctrl.period"\x3e\x3c/select\x3e\n    \x3c/h1\x3e\n\n    \x3cbucket categories\x3d"\'Expenses Income Equity Liabilities\'" period\x3d"$ctrl.period"\x3e\x3c/bucket\x3e\n  \x3c/div\x3e\n'});
